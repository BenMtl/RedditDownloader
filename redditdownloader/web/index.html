<HTML lang="en">
	<head>
		<title>Reddit Media Downloader</title>
		<link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
		<script crossorigin src="js/libs/react-16.7.js"></script>
		<script crossorigin src="js/libs/react-dom-16.7.js"></script>
		<script type="application/javascript" src="js/libs/babel-6.26.0.js"></script>
		<script src="js/libs/deepmerge.js" type="text/javascript"></script>
		<script src="js/libs/showdown-1.8.6.min.js" type="text/javascript"></script><!-- Markdown converter. -->
		<!--suppress HtmlUnknownTarget -->
		<script src="js/Sources.js" type="text/babel"></script>
		<script src="js/Home.js" type="text/babel"></script>
		<script src="js/Browser.js" type="text/babel"></script>
		<script src="js/Settings.js" type="text/babel"></script>
		<script src="js/App.js" type="text/babel"></script>
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

		<link rel="stylesheet" href="css/alertify.css" id="alertifyCSS">
		<link rel="stylesheet" href="css/style.css" type="text/css" >
		<link rel="icon" href="img/logo.png">
	</head>

	<body>
		<div id="root"></div>
	</body>
	<script src="js/libs/alertify-1.0.11.js"></script><!-- Must call at end, so alertify can mount body properly. -->
	<script>
		/**  Store the given Key/Value pair in localStorage. */
		window.lStore = (key, value) => {
			localStorage.setItem(key, JSON.stringify(value))
		};

		/** Load the given key from localStorage. */
		window.lRead = (key, def=null) => {
			let v = localStorage.getItem(key);
			if(!v) return def;
			return JSON.parse(v);
		};

		// Build an EventTarget for publishing events, and set up a few convenience wrapper methods:
		window.eventStream = new EventTarget();
		window.eventStream.send = (type, value) => {
			const evt = new Event(type);
			evt.value = value;
			window.eventStream.dispatchEvent(evt);
		};
		window.eventStream.on = (type, callback) => {
			return window.eventStream.addEventListener(type, evt => {
				callback(evt.value)
			});
		};

		/**
		 * Call the RMD API service via HTTP.
		 * @param url
		 * @param data
		 * @param method
		 * @returns {Promise<any>}
		 */
		window.api = async (url = '', data = {}, method='GET') => {
			url = new URL(location.protocol + '//' + document.domain + ':' + location.port + '/api/' + url);
			let body = JSON.stringify(data);
			if (method === 'GET') {
				body = null;
				// noinspection JSValidateTypes
				url.search = new URLSearchParams(data);
			}
			console.debug('API Query:', url);
			// Default options are marked with *
			const response = await fetch(url.toString(), {
				method, // *GET, POST, PUT, DELETE, etc.
				mode: 'cors', // no-cors, *cors, same-origin
				cache: 'no-cache', // *default, no-cache, reload, force-cache, only-if-cached
				credentials: 'same-origin', // include, *same-origin, omit
				headers: {
					'Content-Type': 'application/json'
				},
				redirect: 'follow', // manual, *follow, error
				referrer: 'no-referrer', // no-referrer, *client
				body
			});
			return await response.json();
		}
	</script>
</HTML>
